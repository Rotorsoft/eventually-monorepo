<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Eventually Framework</title><meta name="description" content="Documentation for Eventually Framework"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Eventually Framework</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>Eventually Framework</h2></div><div class="tsd-panel tsd-typography"><a id="md:eventually-monorepo" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Eventually Monorepo<a href="#md:eventually-monorepo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><img src="https://github.com/rotorsoft/eventually-monorepo/actions/workflows/ci-cd.yml/badge.svg?branch=master" alt="Build Status">
<img src="https://github.com/rotorsoft/eventually-monorepo/actions/workflows/codeql-analysis.yml/badge.svg?branch=master" alt="CodeQL Status">
<a href="https://coveralls.io/github/Rotorsoft/eventually-monorepo?branch=master" target="_blank" class="external"><img src="https://coveralls.io/repos/github/Rotorsoft/eventually-monorepo/badge.svg?branch=master" alt="Coverage Status"></a></p>
<a id="md:writing-a-hotel-reservation-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Writing a Hotel Reservation System<a href="#md:writing-a-hotel-reservation-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This tutorial was inspired by <a href="https://medium.com/thedevproject/clean-architecture-a-basic-example-of-folders-organization-aab07f9eea68" target="_blank" class="external">https://medium.com/thedevproject/clean-architecture-a-basic-example-of-folders-organization-aab07f9eea68</a>. Here we will show a different approach to coding the same API using <a href="media/README.md">Eventually</a>.</p>
<a id="md:1-domain-model" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>1.</strong> Domain Model<a href="#md:1-domain-model" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In <a href="media/README.md">Eventually</a>, <strong>the model</strong> is king, and code is just a side effect. All important decisions are made on the modeling surface before they get transferred to code.</p>
<blockquote>
<p>We recommend using <a href="https://www.eventstormingcom/" target="_blank" class="external">Event Storming</a> or <a href="https://eventmodeling.org/" target="_blank" class="external">Event Modeling</a> to clearly define what we are trying to build in lego-like business-friendly terms.</p>
</blockquote>
<p>In this particular API, we are modeling:</p>
<ul>
<li>A hotel administrator that can open rooms to reservations - via <code>OpenRoom</code> commands</li>
<li>Customers that can query a <code>Hotel</code> for available rooms - via <code>SearchRoom</code> query commands</li>
<li>Customers that can book available rooms - via <code>BookRoom</code> commands</li>
</ul>
<p>The Event Storming model is super simple and captures:</p>
<ul>
<li>A <code>Room</code> aggregate receiving <code>OpenRoom</code>, <code>BookRoom</code> commands and emitting <code>RoomOpened</code>, <code>RoomBooked</code> events that are projected into a <code>Hotel</code> read model</li>
</ul>
<p><img src="media/hotel.png" alt="Hotel Reservation System Model"></p>
<a id="md:2-schemas" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>2.</strong> Schemas<a href="#md:2-schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Aggregates and Read Models have <strong>State</strong> that can be stored. We must think about the shape and validation guards of these schemas next...<em>following the original post</em>:</p>
<pre><code class="typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">enum</span><span class="hl-1"> </span><span class="hl-3">RoomType</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">SINGLE</span><span class="hl-1"> = </span><span class="hl-5">&quot;single&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">DOUBLE</span><span class="hl-1"> = </span><span class="hl-5">&quot;double&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">DELUXE</span><span class="hl-1"> = </span><span class="hl-5">&quot;deluxe&quot;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Reservation</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">checkin</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">checkout</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">totalPrice</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Room</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-6">number</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">type</span><span class="hl-1">: </span><span class="hl-3">RoomType</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">price</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">reservations</span><span class="hl-1">?: </span><span class="hl-3">Reservation</span><span class="hl-1">[];</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Hotel</span><span class="hl-1"> = </span><span class="hl-3">Record</span><span class="hl-1">&lt;</span><span class="hl-3">number</span><span class="hl-1">, </span><span class="hl-3">Room</span><span class="hl-1">&gt;;</span>
</code><button type="button">Copy</button></pre>

<a id="md:3-transfer-model-to-code" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>3.</strong> Transfer Model to Code<a href="#md:3-transfer-model-to-code" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>With a model and clear schemas we are ready to code...</p>
<pre><code class="bash"><span class="hl-7">mkdir</span><span class="hl-1"> </span><span class="hl-5">hotel</span><br/><span class="hl-7">cd</span><span class="hl-1"> </span><span class="hl-5">hotel</span><br/><span class="hl-7">npm</span><span class="hl-1"> </span><span class="hl-5">init</span><span class="hl-1"> </span><span class="hl-8"># follow prompt</span><br/><span class="hl-7">npx</span><span class="hl-1"> </span><span class="hl-5">tsc</span><span class="hl-1"> </span><span class="hl-2">--init</span><br/><span class="hl-7">npm</span><span class="hl-1"> </span><span class="hl-5">i</span><span class="hl-1"> </span><span class="hl-2">--save</span><span class="hl-1"> </span><span class="hl-5">zod</span><span class="hl-1"> </span><span class="hl-5">@rotorsoft/eventually</span><span class="hl-1"> </span><span class="hl-5">@rotorsoft/eventually-express</span><br/><span class="hl-7">npm</span><span class="hl-1"> </span><span class="hl-5">i</span><span class="hl-1"> </span><span class="hl-2">--save-dev</span><span class="hl-1"> </span><span class="hl-5">ts-node-dev</span><span class="hl-1"> </span><span class="hl-5">jest</span><span class="hl-1"> </span><span class="hl-5">@types/jest</span>
</code><button type="button">Copy</button></pre>

<a id="md:packagejson" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><em>package.json</em><a href="#md:packagejson" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;hotel&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;1.0.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;description&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;Hotel Reservation System&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;main&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;index.js&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;scripts&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;start:dev&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;npx ts-node-dev --respawn ./src/index.ts&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;test&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;npx tsc &amp;&amp; jest ./dist/**/*.spec.js&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;author&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;your name&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;email&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;your@email.com&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;license&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;ISC&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;dependencies&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;@rotorsoft/eventually&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;^5.0.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;@rotorsoft/eventually-express&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;^5.0.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;zod&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;^3.19.1&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;devDependencies&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;@types/jest&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;^29.1.2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;jest&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;^29.2.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;ts-node-dev&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;^2.0.0&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:tsconfigjson" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><em>tsconfig.json</em><a href="#md:tsconfigjson" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;compilerOptions&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;module&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;commonjs&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;target&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;ES2021&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;sourceMap&quot;</span><span class="hl-1">: </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;declaration&quot;</span><span class="hl-1">: </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;declarationMap&quot;</span><span class="hl-1">: </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;noImplicitAny&quot;</span><span class="hl-1">: </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;esModuleInterop&quot;</span><span class="hl-1">: </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;skipLibCheck&quot;</span><span class="hl-1">: </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;sourceRoot&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;./src&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">&quot;outDir&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;./dist&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;include&quot;</span><span class="hl-1">: [</span><span class="hl-5">&quot;src&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Add a dummy entry point <em>./src/index.ts</em></p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">app</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@rotorsoft/eventually&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">ExpressApp</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@rotorsoft/eventually-express&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">app</span><span class="hl-1">(</span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">ExpressApp</span><span class="hl-1">()).</span><span class="hl-7">build</span><span class="hl-1">();</span><br/><span class="hl-2">void</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1">().</span><span class="hl-7">listen</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>and make sure it runs...</p>
<pre><code class="bash"><span class="hl-6">LOG_LEVEL</span><span class="hl-1">=</span><span class="hl-5">&quot;trace&quot;</span><span class="hl-1"> </span><span class="hl-7">npm</span><span class="hl-1"> </span><span class="hl-5">run</span><span class="hl-1"> </span><span class="hl-5">start:dev</span>
</code><button type="button">Copy</button></pre>

<a id="md:transfer-schemas" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Transfer schemas<a href="#md:transfer-schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Message payloads also have schemas. We use <a href="https://zod.dev/" target="_blank" class="external">zod</a> with type inference to define our schemas and types...</p>
<a id="md:srcroomschemasts" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><em>./src/Room.schemas.ts</em><a href="#md:srcroomschemasts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">z</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;zod&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">enum</span><span class="hl-1"> </span><span class="hl-3">RoomType</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">SINGLE</span><span class="hl-1"> = </span><span class="hl-5">&quot;single&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">DOUBLE</span><span class="hl-1"> = </span><span class="hl-5">&quot;double&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">DELUXE</span><span class="hl-1"> = </span><span class="hl-5">&quot;deluxe&quot;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">Reservation</span><span class="hl-1"> = </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">object</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">id:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">string</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">checkin:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">date</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">checkout:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">date</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">totalPrice:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">number</span><span class="hl-1">()</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">Room</span><span class="hl-1"> = </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">object</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">number:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">number</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">nativeEnum</span><span class="hl-1">(</span><span class="hl-6">RoomType</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">price:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">number</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">reservations:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">array</span><span class="hl-1">(</span><span class="hl-6">Reservation</span><span class="hl-1">).</span><span class="hl-7">optional</span><span class="hl-1">()</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">BookRoom</span><span class="hl-1"> = </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">intersection</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">object</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-6">number:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">number</span><span class="hl-1">()</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">  </span><span class="hl-6">Reservation</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">SearchRoom</span><span class="hl-1"> = </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">object</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">checkin:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">date</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">checkout:</span><span class="hl-1"> </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-7">date</span><span class="hl-1">()</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:srcroommodelsts" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><em>./src/Room.models.ts</em><a href="#md:srcroommodelsts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">z</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;zod&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;./Room.schemas&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Reservation</span><span class="hl-1"> = </span><span class="hl-3">z</span><span class="hl-1">.</span><span class="hl-3">infer</span><span class="hl-1">&lt;</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Reservation</span><span class="hl-1">&gt;;</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">Room</span><span class="hl-1"> = </span><span class="hl-3">z</span><span class="hl-1">.</span><span class="hl-3">infer</span><span class="hl-1">&lt;</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Room</span><span class="hl-1">&gt;;</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">BookRoom</span><span class="hl-1"> = </span><span class="hl-3">z</span><span class="hl-1">.</span><span class="hl-3">infer</span><span class="hl-1">&lt;</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">BookRoom</span><span class="hl-1">&gt;;</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">SearchRoom</span><span class="hl-1"> = </span><span class="hl-3">z</span><span class="hl-1">.</span><span class="hl-3">infer</span><span class="hl-1">&lt;</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">SearchRoom</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">RoomCommands</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-6">OpenRoom</span><span class="hl-1">: </span><span class="hl-3">Room</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">BookRoom</span><span class="hl-1">: </span><span class="hl-3">BookRoom</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">RoomEvents</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-6">RoomOpened</span><span class="hl-1">: </span><span class="hl-3">Room</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">RoomBooked</span><span class="hl-1">: </span><span class="hl-3">BookRoom</span><span class="hl-1">;</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="md:a-dummy-version-of-srcroomaggregatets" class="tsd-anchor"></a><h4 class="tsd-anchor-link">A dummy version of <em>./src/Room.aggregate.ts`</em><a href="#md:a-dummy-version-of-srcroomaggregatets" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Aggregate</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@rotorsoft/eventually&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;./Room.schemas&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">models</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;./Room.models&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">Room</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">): </span><span class="hl-3">Aggregate</span><span class="hl-1">&lt;</span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><span class="hl-1">, </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">RoomCommands</span><span class="hl-1">, </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">RoomEvents</span><span class="hl-1">&gt; </span><span class="hl-2">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-6">schemas:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">state:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Room</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">commands:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">OpenRoom:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Room</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">BookRoom:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">BookRoom</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">events:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">RoomOpened:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Room</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">RoomBooked:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">BookRoom</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-6">description:</span><span class="hl-1"> </span><span class="hl-5">&quot;A bookable hotel room&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">stream</span><span class="hl-6">:</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Room-</span><span class="hl-2">${</span><span class="hl-6">id</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">init</span><span class="hl-6">:</span><span class="hl-1"> (): </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-6">number:</span><span class="hl-1"> +</span><span class="hl-6">id</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">RoomType</span><span class="hl-1">.</span><span class="hl-4">SINGLE</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">price:</span><span class="hl-1"> </span><span class="hl-10">0</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">  </span><span class="hl-6">reduce:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">RoomOpened</span><span class="hl-6">:</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">RoomBooked</span><span class="hl-6">:</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-2">undefined</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">OpenRoom</span><span class="hl-6">:</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">Promise</span><span class="hl-1">.</span><span class="hl-7">resolve</span><span class="hl-1">([]),</span><br/><span class="hl-1">    </span><span class="hl-7">BookRoom</span><span class="hl-6">:</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">Promise</span><span class="hl-1">.</span><span class="hl-7">resolve</span><span class="hl-1">([])</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Now we can finish <em>./src/index.ts</em> by registering the new aggregate with the app builder...</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">app</span><span class="hl-1">, </span><span class="hl-6">bootstrap</span><span class="hl-1">, </span><span class="hl-6">InMemorySnapshotStore</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@rotorsoft/eventually&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">ExpressApp</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@rotorsoft/eventually-express&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Room</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;./Room.aggregate&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">void</span><span class="hl-1"> </span><span class="hl-7">bootstrap</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> (): </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">void</span><span class="hl-1">&gt; </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">app</span><span class="hl-1">(</span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">ExpressApp</span><span class="hl-1">()).</span><span class="hl-7">with</span><span class="hl-1">(</span><span class="hl-6">Room</span><span class="hl-1">).</span><span class="hl-7">build</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1">().</span><span class="hl-7">listen</span><span class="hl-1">();</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Since we are using <strong>ExpressApp</strong>, the aggregate should be now exposed by HTTP endpoints...</p>
<pre><code class="bash"><span class="hl-6">LOG_LEVEL</span><span class="hl-1">=</span><span class="hl-5">&quot;trace&quot;</span><span class="hl-1"> </span><span class="hl-7">npm</span><span class="hl-1"> </span><span class="hl-5">run</span><span class="hl-1"> </span><span class="hl-5">start:dev</span><br/><span class="hl-7">...</span><br/><span class="hl-1">[INFO] 15:40:54 ts-node-dev ver. 2.0.0 (</span><span class="hl-7">using</span><span class="hl-1"> </span><span class="hl-5">ts-node</span><span class="hl-1"> </span><span class="hl-5">ver.</span><span class="hl-1"> </span><span class="hl-5">10.9.1,</span><span class="hl-1"> </span><span class="hl-5">typescript</span><span class="hl-1"> </span><span class="hl-5">ver.</span><span class="hl-1"> </span><span class="hl-10">4.7.2</span><span class="hl-1">)</span><br/><span class="hl-1">[12417] ✨ config</span><br/><span class="hl-1">[12417] ✨ devLog</span><br/><span class="hl-1">[12417] ✨ ExpressApp</span><br/><span class="hl-1"> </span><span class="hl-7">GET</span><span class="hl-1">  </span><span class="hl-5">/room/:id</span><br/><span class="hl-1"> </span><span class="hl-7">GET</span><span class="hl-1">  </span><span class="hl-5">/room/:id/stream</span><br/><span class="hl-1"> </span><span class="hl-7">GET</span><span class="hl-1">  </span><span class="hl-5">/room</span><br/><span class="hl-1"> </span><span class="hl-7">POST</span><span class="hl-1">  </span><span class="hl-5">/room/:id/open-room</span><br/><span class="hl-1"> </span><span class="hl-7">POST</span><span class="hl-1">  </span><span class="hl-5">/room/:id/book-room</span><br/><span class="hl-1"> </span><span class="hl-7">GET</span><span class="hl-1">  </span><span class="hl-5">/all?[stream=...][</span><span class="hl-1">&amp;</span><span class="hl-6">names</span><span class="hl-1">=</span><span class="hl-5">...</span><span class="hl-1">][&amp;after=-1][&amp;limit=1][&amp;before=...][&amp;created_after=...][&amp;created_before=...]</span><br/><span class="hl-1"> </span><span class="hl-7">GET</span><span class="hl-1">  </span><span class="hl-5">/_stats</span><br/><span class="hl-7">Express</span><span class="hl-1"> </span><span class="hl-5">app</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> </span><span class="hl-5">listening</span><span class="hl-1">  </span><span class="hl-5">{</span><br/><span class="hl-1">  </span><span class="hl-7">env:</span><span class="hl-1"> </span><span class="hl-5">&#39;development&#39;,</span><br/><span class="hl-1">  </span><span class="hl-7">port:</span><span class="hl-1"> </span><span class="hl-5">3000,</span><br/><span class="hl-1">  </span><span class="hl-7">logLevel:</span><span class="hl-1"> </span><span class="hl-5">&#39;trace&#39;,</span><br/><span class="hl-1">  </span><span class="hl-7">service:</span><span class="hl-1"> </span><span class="hl-5">&#39;hotel&#39;,</span><br/><span class="hl-1">  </span><span class="hl-7">version:</span><span class="hl-1"> </span><span class="hl-5">&#39;1.0.0&#39;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:4-write-tests-first" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>4.</strong> Write Tests First<a href="#md:4-write-tests-first" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In this case, we will just implement a couple of basic tests following the original post, but these should be enough to cover most of the code we will write later...</p>
<blockquote>
<p>Always decide what you are testing before implementing the core logic (model guards/invariants and projections)</p>
</blockquote>
<a id="md:src__tests__roomspects" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><em>./src/__tests__/Room.spec.ts</em><a href="#md:src__tests__roomspects" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">app</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">client</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">dispose</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">InMemorySnapshotStore</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">Snapshot</span><br/><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@rotorsoft/eventually&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Room</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;../Room.aggregate&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">models</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;../Room.models&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;../Room.schemas&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">openRoom</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-6">room</span><span class="hl-1">: </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><br/><span class="hl-1">): </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">Snapshot</span><span class="hl-1">&lt;</span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><span class="hl-1">, </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">RoomEvents</span><span class="hl-1">&gt;[]&gt; </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-7">client</span><span class="hl-1">().</span><span class="hl-7">command</span><span class="hl-1">(</span><span class="hl-6">Room</span><span class="hl-1">, </span><span class="hl-5">&quot;OpenRoom&quot;</span><span class="hl-1">, </span><span class="hl-6">room</span><span class="hl-1">, { </span><span class="hl-6">id:</span><span class="hl-1"> </span><span class="hl-6">room</span><span class="hl-1">.</span><span class="hl-6">number</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() });</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">bookRoom</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-6">number</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">reservation</span><span class="hl-1">: </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Reservation</span><br/><span class="hl-1">): </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">Snapshot</span><span class="hl-1">&lt;</span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><span class="hl-1">, </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">RoomEvents</span><span class="hl-1">&gt;[]&gt; </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-7">client</span><span class="hl-1">().</span><span class="hl-7">command</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">Room</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;BookRoom&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    { </span><span class="hl-6">number</span><span class="hl-1">, ...</span><span class="hl-6">reservation</span><span class="hl-1"> },</span><br/><span class="hl-1">    { </span><span class="hl-6">id:</span><span class="hl-1"> </span><span class="hl-6">number</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">() }</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-7">describe</span><span class="hl-1">(</span><span class="hl-5">&quot;Room&quot;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">snapshotStore</span><span class="hl-1"> = </span><span class="hl-7">InMemorySnapshotStore</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-7">beforeAll</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">app</span><span class="hl-1">().</span><span class="hl-7">with</span><span class="hl-1">(</span><span class="hl-6">Room</span><span class="hl-1">).</span><span class="hl-7">build</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1">().</span><span class="hl-7">listen</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">openRoom</span><span class="hl-1">({ </span><span class="hl-6">number:</span><span class="hl-1"> </span><span class="hl-10">101</span><span class="hl-1">, </span><span class="hl-6">price:</span><span class="hl-1"> </span><span class="hl-10">100</span><span class="hl-1">, </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">RoomType</span><span class="hl-1">.</span><span class="hl-4">SINGLE</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">openRoom</span><span class="hl-1">({ </span><span class="hl-6">number:</span><span class="hl-1"> </span><span class="hl-10">102</span><span class="hl-1">, </span><span class="hl-6">price:</span><span class="hl-1"> </span><span class="hl-10">200</span><span class="hl-1">, </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">RoomType</span><span class="hl-1">.</span><span class="hl-4">DOUBLE</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">openRoom</span><span class="hl-1">({ </span><span class="hl-6">number:</span><span class="hl-1"> </span><span class="hl-10">103</span><span class="hl-1">, </span><span class="hl-6">price:</span><span class="hl-1"> </span><span class="hl-10">300</span><span class="hl-1">, </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">RoomType</span><span class="hl-1">.</span><span class="hl-4">DELUXE</span><span class="hl-1"> });</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">afterAll</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">dispose</span><span class="hl-1">()();</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">it</span><span class="hl-1">(</span><span class="hl-5">&quot;should search rooms&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">rooms</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">snapshotStore</span><span class="hl-1">.</span><span class="hl-7">query</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-7">expect</span><span class="hl-1">(</span><span class="hl-6">rooms</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1">).</span><span class="hl-7">toBe</span><span class="hl-1">(</span><span class="hl-10">3</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">it</span><span class="hl-1">(</span><span class="hl-5">&quot;should book room&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">checkin</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">checkout</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">(</span><span class="hl-6">checkin</span><span class="hl-1">.</span><span class="hl-7">getTime</span><span class="hl-1">() + </span><span class="hl-10">2</span><span class="hl-1"> * </span><span class="hl-10">24</span><span class="hl-1"> * </span><span class="hl-10">60</span><span class="hl-1"> * </span><span class="hl-10">60</span><span class="hl-1"> * </span><span class="hl-10">1000</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">room</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">bookRoom</span><span class="hl-1">(</span><span class="hl-10">102</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-6">id:</span><span class="hl-1"> </span><span class="hl-5">&quot;r1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">checkin</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">checkout</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">totalPrice:</span><span class="hl-1"> </span><span class="hl-10">0</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-7">expect</span><span class="hl-1">(</span><span class="hl-6">room</span><span class="hl-1">[</span><span class="hl-10">0</span><span class="hl-1">].</span><span class="hl-6">state</span><span class="hl-1">?.</span><span class="hl-6">reservations</span><span class="hl-1">?.</span><span class="hl-6">length</span><span class="hl-1">).</span><span class="hl-7">toBe</span><span class="hl-1">(</span><span class="hl-10">1</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">expect</span><span class="hl-1">(</span><span class="hl-6">room</span><span class="hl-1">[</span><span class="hl-10">0</span><span class="hl-1">].</span><span class="hl-6">state</span><span class="hl-1">?.</span><span class="hl-6">reservations</span><span class="hl-1">[</span><span class="hl-10">0</span><span class="hl-1">].</span><span class="hl-6">totalPrice</span><span class="hl-1">).</span><span class="hl-7">toBe</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-10">2</span><span class="hl-1"> * </span><span class="hl-6">room</span><span class="hl-1">[</span><span class="hl-10">0</span><span class="hl-1">].</span><span class="hl-6">state</span><span class="hl-1">.</span><span class="hl-6">price</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">it</span><span class="hl-1">(</span><span class="hl-5">&quot;should fail booking&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">checkin</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">checkout</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">(</span><span class="hl-6">checkin</span><span class="hl-1">.</span><span class="hl-7">getTime</span><span class="hl-1">() + </span><span class="hl-10">2</span><span class="hl-1"> * </span><span class="hl-10">24</span><span class="hl-1"> * </span><span class="hl-10">60</span><span class="hl-1"> * </span><span class="hl-10">60</span><span class="hl-1"> * </span><span class="hl-10">1000</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">bookRoom</span><span class="hl-1">(</span><span class="hl-10">103</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-6">id:</span><span class="hl-1"> </span><span class="hl-5">&quot;r2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">checkin</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">checkout</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">totalPrice:</span><span class="hl-1"> </span><span class="hl-10">0</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">expect</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-7">bookRoom</span><span class="hl-1">(</span><span class="hl-10">103</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-6">id:</span><span class="hl-1"> </span><span class="hl-5">&quot;r3&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-6">checkin</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-6">checkout</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-6">totalPrice:</span><span class="hl-1"> </span><span class="hl-10">0</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    ).</span><span class="hl-6">rejects</span><span class="hl-1">.</span><span class="hl-7">toThrowError</span><span class="hl-1">();</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Your project should look like this...</p>
<p><img src="./assets/hotel-project.png" alt="Hotel Project"></p>
<a id="md:5-finish-the-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>5.</strong> Finish the API<a href="#md:5-finish-the-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>At this point all tests are failing...</p>
<p><img src="./assets/coverage-failed.png" alt="Unit Test Coverage"></p>
<p>We can now focus on closing the implementation gaps...</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-6">Aggregate</span><span class="hl-1">, </span><span class="hl-6">bind</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;@rotorsoft/eventually&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;./Room.schemas&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-6">models</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-5">&quot;./Room.models&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">nights</span><span class="hl-1"> = (</span><span class="hl-6">reservation</span><span class="hl-1">: </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Reservation</span><span class="hl-1">): </span><span class="hl-3">number</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">dtime</span><span class="hl-1"> = </span><span class="hl-6">reservation</span><span class="hl-1">.</span><span class="hl-6">checkout</span><span class="hl-1">.</span><span class="hl-7">getTime</span><span class="hl-1">() - </span><span class="hl-6">reservation</span><span class="hl-1">.</span><span class="hl-6">checkin</span><span class="hl-1">.</span><span class="hl-7">getTime</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">Math</span><span class="hl-1">.</span><span class="hl-7">round</span><span class="hl-1">(</span><span class="hl-6">dtime</span><span class="hl-1"> / (</span><span class="hl-10">1000</span><span class="hl-1"> * </span><span class="hl-10">3600</span><span class="hl-1"> * </span><span class="hl-10">24</span><span class="hl-1">));</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">isBooked</span><span class="hl-1"> = (</span><span class="hl-6">room</span><span class="hl-1">: </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><span class="hl-1">, </span><span class="hl-6">from</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">, </span><span class="hl-6">to</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">): </span><span class="hl-3">boolean</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">room</span><span class="hl-1">.</span><span class="hl-6">reservations</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">  </span><span class="hl-6">room</span><span class="hl-1">.</span><span class="hl-6">reservations</span><span class="hl-1">.</span><span class="hl-7">some</span><span class="hl-1">(</span><br/><span class="hl-1">    (</span><span class="hl-6">r</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">      (</span><span class="hl-6">from</span><span class="hl-1"> &gt;= </span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkin</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">from</span><span class="hl-1"> &lt;= </span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkout</span><span class="hl-1">) ||</span><br/><span class="hl-1">      (</span><span class="hl-6">to</span><span class="hl-1"> &gt;= </span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkin</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">to</span><span class="hl-1"> &lt;= </span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkout</span><span class="hl-1">) ||</span><br/><span class="hl-1">      (</span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkin</span><span class="hl-1"> &gt;= </span><span class="hl-6">from</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkin</span><span class="hl-1"> &lt;= </span><span class="hl-6">to</span><span class="hl-1">) ||</span><br/><span class="hl-1">      (</span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkout</span><span class="hl-1"> &gt;= </span><span class="hl-6">from</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">r</span><span class="hl-1">.</span><span class="hl-6">checkout</span><span class="hl-1"> &lt;= </span><span class="hl-6">to</span><span class="hl-1">)</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">Room</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-6">id</span><span class="hl-1">: </span><span class="hl-3">string</span><br/><span class="hl-1">): </span><span class="hl-3">Aggregate</span><span class="hl-1">&lt;</span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><span class="hl-1">, </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">RoomCommands</span><span class="hl-1">, </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">RoomEvents</span><span class="hl-1">&gt; </span><span class="hl-2">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-6">schemas:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">state:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Room</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">commands:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">OpenRoom:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Room</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">BookRoom:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">BookRoom</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">events:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">RoomOpened:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">Room</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">RoomBooked:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">BookRoom</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-6">description:</span><span class="hl-1"> </span><span class="hl-5">&quot;A bookable hotel room&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">stream</span><span class="hl-6">:</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Room-</span><span class="hl-2">${</span><span class="hl-6">id</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">init</span><span class="hl-6">:</span><span class="hl-1"> (): </span><span class="hl-3">models</span><span class="hl-1">.</span><span class="hl-3">Room</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-6">number:</span><span class="hl-1"> +</span><span class="hl-6">id</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">schemas</span><span class="hl-1">.</span><span class="hl-6">RoomType</span><span class="hl-1">.</span><span class="hl-4">SINGLE</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">price:</span><span class="hl-1"> </span><span class="hl-10">0</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">  </span><span class="hl-6">reduce:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">RoomOpened</span><span class="hl-6">:</span><span class="hl-1"> (</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">event</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-6">event</span><span class="hl-1">.</span><span class="hl-6">data</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">RoomBooked</span><span class="hl-6">:</span><span class="hl-1"> (</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">event</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      ...</span><span class="hl-6">state</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">reservations:</span><span class="hl-1"> (</span><span class="hl-6">state</span><span class="hl-1">?.</span><span class="hl-6">reservations</span><span class="hl-1"> || []).</span><span class="hl-7">concat</span><span class="hl-1">({</span><br/><span class="hl-1">        ...</span><span class="hl-6">event</span><span class="hl-1">.</span><span class="hl-6">data</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-6">totalPrice:</span><span class="hl-1"> </span><span class="hl-7">nights</span><span class="hl-1">(</span><span class="hl-6">event</span><span class="hl-1">.</span><span class="hl-6">data</span><span class="hl-1">) * </span><span class="hl-6">state</span><span class="hl-1">.</span><span class="hl-6">price</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">OpenRoom</span><span class="hl-6">:</span><span class="hl-1"> (</span><span class="hl-6">data</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">Promise</span><span class="hl-1">.</span><span class="hl-7">resolve</span><span class="hl-1">([</span><span class="hl-7">bind</span><span class="hl-1">(</span><span class="hl-5">&quot;RoomOpened&quot;</span><span class="hl-1">, </span><span class="hl-6">data</span><span class="hl-1">)]),</span><br/><span class="hl-1">    </span><span class="hl-7">BookRoom</span><span class="hl-6">:</span><span class="hl-1"> (</span><span class="hl-6">data</span><span class="hl-1">, </span><span class="hl-6">state</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-7">isBooked</span><span class="hl-1">(</span><span class="hl-6">state</span><span class="hl-1">, </span><span class="hl-6">data</span><span class="hl-1">.</span><span class="hl-6">checkin</span><span class="hl-1">, </span><span class="hl-6">data</span><span class="hl-1">.</span><span class="hl-6">checkout</span><span class="hl-1">))</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">`Room </span><span class="hl-2">${</span><span class="hl-6">state</span><span class="hl-11">.</span><span class="hl-6">number</span><span class="hl-2">}</span><span class="hl-5"> is booked.`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-3">Promise</span><span class="hl-1">.</span><span class="hl-7">resolve</span><span class="hl-1">([</span><span class="hl-7">bind</span><span class="hl-1">(</span><span class="hl-5">&quot;RoomBooked&quot;</span><span class="hl-1">, </span><span class="hl-6">data</span><span class="hl-1">)]);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>At this point all unit tests should pass with excellent coverage...</p>
<p><img src="./assets/coverage.png" alt="Unit Test Coverage"></p>
<p>The service also provides a default homepage with the OpenAPI spec of the service and a few links to stats and metadata...</p>
<blockquote>
<p>Local development defaults to <a href="http://localhost:3000" target="_blank" class="external">http://localhost:3000</a></p>
</blockquote>
<p><img src="./assets/openapi.png" alt="Home"></p>
<a id="md:hotel-projections" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Hotel Projections<a href="#md:hotel-projections" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Room events can be projected into read models that are useful to feed the user interface or make policy decisions. Here you can find a <a href="./services/hotel/src/Hotel.projector.ts">Hotel</a> projector with the current state of all rooms, and a second <a href="./services/hotel/src/Next30Days.projector.ts">Next30Days</a> projector keeping track of room sales looking forward 30 days. The sample application exposes a very basic <code>/home</code> view, showing how these projections can be used to feed the UI.</p>
<a id="md:testing-the-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Testing the API<a href="#md:testing-the-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can use any of the following HTTP test clients to validate the API:</p>
<ul>
<li>REST Client VSCode extension</li>
<li>Thunder Client VSCode extension</li>
<li>Postman</li>
</ul>
<p>Here is a sample REST Client file:</p>
<a id="md:httproomhttp" class="tsd-anchor"></a><h4 class="tsd-anchor-link"><em>./http/Room.http</em><a href="#md:httproomhttp" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="bash"><span class="hl-7">@host</span><span class="hl-1"> </span><span class="hl-5">=</span><span class="hl-1"> </span><span class="hl-5">http://localhost:3000</span><br/><br/><span class="hl-8">### Try to open room 101 with invalid command</span><br/><span class="hl-7">POST</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/101/open-room</span><br/><span class="hl-7">Content-Type:</span><span class="hl-1"> </span><span class="hl-5">application/json</span><br/><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;number&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;101&quot;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">### Open room 101</span><br/><span class="hl-7">POST</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/101/open-room</span><br/><span class="hl-7">Content-Type:</span><span class="hl-1"> </span><span class="hl-5">application/json</span><br/><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;number&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">101,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;price&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">100,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;type&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;single&quot;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">### Try to open room 102 with invalid type</span><br/><span class="hl-7">POST</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/102/open-room</span><br/><span class="hl-7">Content-Type:</span><span class="hl-1"> </span><span class="hl-5">application/json</span><br/><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;number&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;102&quot;,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;price&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">200,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;type&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;invalid&quot;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">### Open room 102</span><br/><span class="hl-7">POST</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/102/open-room</span><br/><span class="hl-7">Content-Type:</span><span class="hl-1"> </span><span class="hl-5">application/json</span><br/><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;number&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">102,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;price&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">200,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;type&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;double&quot;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">### Book room 101</span><br/><span class="hl-7">POST</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/101/book-room</span><br/><span class="hl-7">Content-Type:</span><span class="hl-1"> </span><span class="hl-5">application/json</span><br/><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;id&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;booking-1&quot;,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;number&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">101,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;checkin&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;2022-12-01&quot;,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;checkout&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;2022-12-03&quot;,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;totalPrice&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-10">0</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">### Try to book room 101 again</span><br/><span class="hl-7">POST</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/101/book-room</span><br/><span class="hl-7">Content-Type:</span><span class="hl-1"> </span><span class="hl-5">application/json</span><br/><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;id&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;booking-1&quot;,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;number&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">101,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;checkin&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;2022-12-01&quot;,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;checkout&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-5">&quot;2022-12-03&quot;,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;totalPrice&quot;</span><span class="hl-7">:</span><span class="hl-1"> </span><span class="hl-10">0</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">### Get Room 101</span><br/><span class="hl-7">GET</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/101</span><br/><br/><span class="hl-8">### Get Room 101 stream</span><br/><span class="hl-7">GET</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room/101/stream</span><br/><br/><span class="hl-8">### Get Rooms</span><br/><span class="hl-7">GET</span><span class="hl-1"> </span><span class="hl-5">{{host}}/room</span><br/><br/><span class="hl-8">### Get store stats</span><br/><span class="hl-7">GET</span><span class="hl-1"> </span><span class="hl-5">{{host}}/_stats</span><br/><br/><span class="hl-8">### Get internal subscriptions</span><br/><span class="hl-7">GET</span><span class="hl-1"> </span><span class="hl-5">{{host}}/_subscriptions</span>
</code><button type="button">Copy</button></pre>

<a id="md:generic-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Generic Services<a href="#md:generic-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>In this example, we created a new <code>hotel</code> service containing room artifacts and the service configuration in <code>index.ts</code>. In production systems, we can streamline this process by separating artifact containers from service configuration via <a href="media/README-1.md">preconfigured generic services</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:eventually-monorepo"><span>Eventually <wbr/>Monorepo</span></a><ul><li><a href="#md:writing-a-hotel-reservation-system"><span>Writing a <wbr/>Hotel <wbr/>Reservation <wbr/>System</span></a></li><li><ul><li><a href="#md:1-domain-model"><span>1. <wbr/>Domain <wbr/>Model</span></a></li><li><a href="#md:2-schemas"><span>2. <wbr/>Schemas</span></a></li><li><a href="#md:3-transfer-model-to-code"><span>3. <wbr/>Transfer <wbr/>Model to <wbr/>Code</span></a></li><li><ul><li><a href="#md:packagejson"><span>package.json</span></a></li><li><a href="#md:tsconfigjson"><span>tsconfig.json</span></a></li><li><a href="#md:transfer-schemas"><span>Transfer schemas</span></a></li><li><a href="#md:srcroomschemasts"><span>./src/<wbr/>Room.schemas.ts</span></a></li><li><a href="#md:srcroommodelsts"><span>./src/<wbr/>Room.models.ts</span></a></li><li><a href="#md:a-dummy-version-of-srcroomaggregatets"><span>A dummy version of ./src/<wbr/>Room.aggregate.ts`</span></a></li></ul></li><li><a href="#md:4-write-tests-first"><span>4. <wbr/>Write <wbr/>Tests <wbr/>First</span></a></li><li><ul><li><a href="#md:src__tests__roomspects"><span>./src/__tests__/<wbr/>Room.spec.ts</span></a></li></ul></li><li><a href="#md:5-finish-the-api"><span>5. <wbr/>Finish the API</span></a></li><li><a href="#md:hotel-projections"><span>Hotel <wbr/>Projections</span></a></li><li><a href="#md:testing-the-api"><span>Testing the API</span></a></li><li><ul><li><a href="#md:httproomhttp"><span>./http/<wbr/>Room.http</span></a></li></ul></li></ul></li><li><a href="#md:generic-services"><span>Generic <wbr/>Services</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>Eventually Framework</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
